/*! For license information please see elastic-apm-js-base.umd.min.js.LICENSE */
!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=6)}([function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=[].slice;function o(){return"withCredentials"in new window.XMLHttpRequest}function s(t,e,n,r){return"number"==typeof t&&(t=String(t)),n&&!t&&(t=r||"NA"),t?String(t).substr(0,e):t}function a(t){return null!==t&&"object"===(void 0===t?"undefined":r(t))}function c(t){return"function"==typeof t}t.exports={getViewPortInfo:function(){var t=document.documentElement,e=document.getElementsByTagName("body")[0];return{width:window.innerWidth||t.clientWidth||e.clientWidth,height:window.innerHeight||t.clientHeight||e.clientHeight}},mergeObject:function(t,e){var n,r={};for(n in t)r[n]=t[n];for(n in e)r[n]=e[n];return r},extend:function(t){return this.baseExtend(t,i.call(arguments,1),!1)},merge:function(t){return this.baseExtend(t,i.call(arguments,1),!0)},baseExtend:function t(e,n,r){for(var i=0,o=n.length;i<o;++i){var s=n[i];if(a(s)||c(s))for(var u=Object.keys(s),f=0,l=u.length;f<l;f++){var h=u[f],p=s[h];r&&a(p)?(a(e[h])||(e[h]=Array.isArray(p)?[]:{}),t(e[h],[p],!1)):e[h]=p}}return e},isObject:a,isFunction:c,arrayReduce:function(t,e,n){if(null==t)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof e)throw new TypeError(e+" is not a function");var r=Object(t),i=r.length>>>0,o=0;if(!n){for(;o<i&&!(o in r);)o++;if(o>=i)throw new TypeError("Reduce of empty array with no initial value");n=r[o++]}for(;o<i;o++)o in r&&(n=e(n,r[o],o,r));return n},arraySome:function(t,e,n){if(null==t)throw new TypeError("Array.prototype.some called on null or undefined");if("function"!=typeof e)throw new TypeError;var r=Object(t),i=r.length>>>0;n||(n=void 0);for(var o=0;o<i;o++)if(o in r&&e.call(n,r[o],o,r))return!0;return!1},arrayMap:function(t,e,n){var r,i,o;if(null==this)throw new TypeError(" this is null or not defined");var s=Object(t),a=s.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(r=n),i=new Array(a),o=0;o<a;){var c,u;o in s&&(c=s[o],u=e.call(r,c,o,s),i[o]=u),o++}return i},arrayIndexOf:function(t,e,n){var r;if(null==t)throw new TypeError('"arrayVal" is null or not defined');var i=Object(t),o=i.length>>>0;if(0===o)return-1;var s=+n||0;if(Math.abs(s)===1/0&&(s=0),s>=o)return-1;for(r=Math.max(s>=0?s:o-Math.abs(s),0);r<o;){if(r in i&&i[r]===e)return r;r++}return-1},functionBind:function(t,e){var n=Array.prototype.slice.call(arguments,2),r=function(){},i=function(){return t.apply(e,n.concat(Array.prototype.slice.call(arguments)))};return r.prototype=t.prototype,i.prototype=new r,i},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},isUndefined:function(t){return void 0===t},isCORSSupported:o,getElasticScript:function(){if("undefined"!=typeof document)for(var t=document.getElementsByTagName("script"),e=0,n=t.length;e<n;e++){var r=t[e];if(r.src.indexOf("elastic")>0)return r}},getCurrentScript:function(){if("undefined"!=typeof document){var t=document.currentScript;return t||this.getElasticScript()}},generateUuid:function(){function t(t){var e=(Math.random().toString(16)+"000000000").substr(2,8);return t?"-"+e.substr(0,4)+"-"+e.substr(4,4):e}return t()+t(!0)+t(!0)+t()},parseUrl:function(t){var e=/^([^\?#]*)(\?([^#]*))?(#(.*))?$/.exec(t),n=e[1]||"",r=e[3]||"",i=e[5]?"#"+e[5]:"",o="";t.indexOf("://")>-1&&(o=t.split("://")[0]+":");for(var s={},a=r.split("&"),c=0,u=a.length;c<u;c++){var f=a[c];if(""!==f&&void 0!==f&&null!==f){var l=a[c].split("=");s[l.shift()]=l.join("=")}}return{protocol:o,path:n,queryString:r,queryStringParsed:s,hash:i}},isPlatformSupported:function(){return"undefined"!=typeof window&&"function"==typeof Array.prototype.forEach&&"function"==typeof JSON.stringify&&"function"==typeof Function.bind&&window.performance&&"function"==typeof window.performance.now&&o()},sanitizeString:s,sanitizeObjectStrings:function t(e,n,i,o){return e?"string"==typeof e?s(e,n,i,o):(Object.keys(e).forEach(function(a){var c=e[a];"string"==typeof c?c=s(e[a],n,i,o):"object"===(void 0===c?"undefined":r(c))&&(c=t(c,n,i,o)),e[a]=c}),e):e}}},function(t,e,n){"use strict";var r=n(8),i=n(15),o=n(20),s=n(0);t.exports={createServiceFactory:function(){var t=new o;return t.registerCoreServices(),r.registerServices(t),i.registerServices(t),t},ServiceFactory:o,patchCommon:n(26),utils:s}},function(t,e,n){"use strict";var r=n(10),i=n(11);t.exports=function(t,e,n){var o=e&&n||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var s=(t=t||{}).random||(t.rng||r)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e)for(var a=0;a<16;++a)e[o+a]=s[a];return e||i(s)}},function(t,e,n){"use strict";var r=n(0);function i(t,e,n){var r=n||{};"function"==typeof r.onSpanEnd?this.onSpanEnd=r.onSpanEnd:this.onSpanEnd=function(){},this.signature=t,this.type=e,this.ended=!1,this._end=null,this.context=null,this._start=window.performance.now()}i.prototype.end=function(){this._end=window.performance.now(),this.ended=!0,this.onSpanEnd(this)},i.prototype.duration=function(){if(r.isUndefined(this.ended)||r.isUndefined(this._start))return null;var t=this._end-this._start;return parseFloat(t)},i.prototype.setContext=function(t){t&&(this.context=r.merge(this.context||{},t))},t.exports=i},function(t,e,n){"use strict";function r(){this.subscriptions=[]}r.prototype.subscribe=function(t){var e=this;return this.subscriptions.push(t),function(){var n=e.subscriptions.indexOf(t);n>-1&&e.subscriptions.splice(n,1)}},r.prototype.applyAll=function(t,e){this.subscriptions.forEach(function(n){try{n.apply(t,e)}catch(t){console.log(t,t.stack)}},this)},t.exports=r},function(t,e,n){"use strict";function r(t){return"__apm_symbol__"+t}t.exports={apmSymbol:r,patchMethod:function(t,e,n){var i=t;for(;i&&!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);!i&&t[e]&&(i=t);var o,s=r(e);i&&!(o=i[s])&&(o=i[s]=i[e],i[e]=function(t,e){try{return Function("f","return function "+t+"(){return f(this, arguments)}")(e)}catch(t){return function(){return e(this,arguments)}}}(e,n(o,s,e)));return o}}},function(t,e,n){"use strict";var r=n(7)(),i=n(1),o=n(30),s=new o(i.createServiceFactory(),!r);"undefined"!=typeof window&&(window.elasticApm=s);var a={__esModule:!0,default:s.init.bind(s),init:s.init.bind(s),ApmBase:o,apmBase:s};t.exports=a},function(t,e,n){"use strict";var r=!1,i=!1;t.exports=function(){if(r)return i;r=!0;var t=n(1);return t.utils.isPlatformSupported()?(n(28),t.patchCommon(),i=!0):console.log("APM: Platform is not supported!"),i}},function(t,e,n){"use strict";var r=n(9);t.exports={ErrorLogging:r,registerServices:function(t){t.registerServiceCreator("ErrorLogging",function(){var e=t.getService("ApmServer"),n=t.getService("ConfigService"),i=t.getService("LoggingService");return new r(e,n,i)})}}},function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var o=n(2),s=n(12),a=n(0),c=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._apmServer=e,this._configService=n,this._loggingService=r,this._stackTraceService=new s(n,r)}return i(t,[{key:"createErrorDataModel",value:function(t){var e,n=this._stackTraceService.cleanFilePath(t.filename),i=this._stackTraceService.filePathToFileName(n),s=this._stackTraceService.createStackTraces(t);if(s=this._stackTraceService.filterInvalidFrames(s),!i&&s.length){var c=s[s.length-1];i=c.filename?c.filename:"(inline script)"}e=this._stackTraceService.isFileInline(n)?"(inline script)":i;var u=t.message||t.error&&t.error.message,f=t.error?t.error.name:void 0;f||(f=u&&u.indexOf(":")>-1?u.split(":")[0]:"");var l,h=this._configService.get("context"),p=this._configService.get("serverStringLimit");t.error&&"object"===r(t.error)&&(l=this._getErrorProperties(t.error));var d=this._getBrowserSpecificMetadata(),v=a.merge({},d,h,l);return{id:o(),timestamp:(new Date).toISOString(),culprit:a.sanitizeString(e),exception:{message:a.sanitizeString(u,void 0,!0),stacktrace:s,type:a.sanitizeString(f,p,!1)},context:v}}},{key:"logErrorEvent",value:function(t,e){if(this._configService.isActive()){if(void 0===t)return;var n=this.createErrorDataModel(t);if(void 0===n.exception.message)return;return e?this._apmServer.sendErrors([n]):this._apmServer.addError(n)}}},{key:"registerGlobalEventListener",value:function(){var t=this;window.onerror=function(e,n,r,i,o){var s;s=void 0!==e&&"string"!=typeof e?e:{message:e,filename:n,lineno:r,colno:i,error:o},t.logErrorEvent(s)}}},{key:"logError",value:function(t){var e={};return"string"==typeof t?e.message=t:e.error=t,this.logErrorEvent(e)}},{key:"_getErrorProperties",value:function(t){var e={};return Object.keys(t).forEach(function(n){if("stack"!==n){var i=t[n];if(null!==i){switch(void 0===i?"undefined":r(i)){case"function":return;case"object":if("function"!=typeof i.toISOString)return;i=i.toISOString()}e[n]=i}}}),e}},{key:"_getBrowserSpecificMetadata",value:function(){var t=a.getViewPortInfo();return{environment:{browserWidth:t.width,browserHeight:t.height,screenWidth:window.screen.width,screenHeight:window.screen.height,language:navigator.language,userAgent:navigator.userAgent,platform:navigator.platform},page:{referer:document.referrer,host:document.domain,location:window.location.href}}}}]),t}();t.exports=c},function(t,e,n){"use strict";var r="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(r){var i=new Uint8Array(16);t.exports=function(){return r(i),i}}else{var o=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),o[e]=t>>>((3&e)<<3)&255;return o}}},function(t,e,n){"use strict";for(var r=[],i=0;i<256;++i)r[i]=(i+256).toString(16).substr(1);t.exports=function(t,e){var n=e||0,i=r;return i[t[n++]]+i[t[n++]]+i[t[n++]]+i[t[n++]]+"-"+i[t[n++]]+i[t[n++]]+"-"+i[t[n++]]+i[t[n++]]+"-"+i[t[n++]]+i[t[n++]]+"-"+i[t[n++]]+i[t[n++]]+i[t[n++]]+i[t[n++]]+i[t[n++]]+i[t[n++]]}},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var i=n(13),o=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._configService=e,this._loggingService=n}return r(t,[{key:"createStackTraces",value:function(t){var e,n=this,r=t.error;if(r)try{e=i.parse(r)}catch(t){this._loggingService.debug("Parsing error stack failed!",t)}return e&&0!==e.length||(e=[{fileName:t.filename,lineNumber:t.lineno,columnNumber:t.colno}]),e=(e=e.map(function(t){return t.functionName&&(t.functionName=(e=t.functionName,n=e.split("/"),e=(e=(e=n.length>1?["Object",n[n.length-1]].join("."):n[0]).replace(/.<$/gi,".<anonymous>")).replace(/^Anonymous function$/,"<anonymous>"),e=(n=e.split(".")).length>1?n[n.length-1]:n[0])),t;var e,n})).map(function(t){if(!t.fileName&&!t.lineNumber)return{};if(!t.columnNumber&&!t.lineNumber)return{};var e=n.cleanFilePath(t.fileName),r=n.filePathToFileName(e);return n.isFileInline(e)&&(r="(inline script)"),{abs_path:t.fileName,filename:r,function:t.functionName||"<anonymous>",lineno:t.lineNumber,colno:t.columnNumber}})}},{key:"filterInvalidFrames",value:function(t){var e=[];return Array.isArray(t)&&(e=t.filter(function(t){return void 0!==t.filename&&void 0!==t.lineno})),e}},{key:"filePathToFileName",value:function(t){var e=window.location.origin||window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");return t.indexOf(e)>-1&&(t=t.replace(e+"/","")),t}},{key:"cleanFilePath",value:function(t){return t||(t=""),"<anonymous>"===t&&(t=""),t}},{key:"isFileInline",value:function(t){return!!t&&0===window.location.href.indexOf(t)}}]),t}();t.exports=o},function(t,e,n){"use strict";var r,i,o,s;"function"==typeof Symbol&&Symbol.iterator;s=function(t){var e=/(^|@)\S+\:\d+/,n=/^\s*at .*(\S+\:\d+|\(native\))/m,r=/^(eval@)?(\[native code\])?$/;function i(t,e,n){if("function"==typeof Array.prototype.map)return t.map(e,n);for(var r=new Array(t.length),i=0;i<t.length;i++)r[i]=e.call(n,t[i]);return r}function o(t,e,n){if("function"==typeof Array.prototype.filter)return t.filter(e,n);for(var r=[],i=0;i<t.length;i++)e.call(n,t[i])&&r.push(t[i]);return r}return{parse:function(t){if(void 0!==t.stacktrace||void 0!==t["opera#sourceloc"])return this.parseOpera(t);if(t.stack&&t.stack.match(n))return this.parseV8OrIE(t);if(t.stack)return this.parseFFOrSafari(t);throw new Error("Cannot parse given Error object")},extractLocation:function(t){if(-1===t.indexOf(":"))return[t];var e=/(.+?)(?:\:(\d+))?(?:\:(\d+))?$/.exec(t.replace(/[\(\)]/g,""));return[e[1],e[2]||void 0,e[3]||void 0]},parseV8OrIE:function(e){return i(o(e.stack.split("\n"),function(t){return!!t.match(n)},this),function(e){e.indexOf("(eval ")>-1&&(e=e.replace(/eval code/g,"eval").replace(/(\(eval at [^\()]*)|(\)\,.*$)/g,""));var n=e.replace(/^\s+/,"").replace(/\(eval code/g,"(").split(/\s+/).slice(1),r=this.extractLocation(n.pop()),i=n.join(" ")||void 0,o=function(t,e){if("function"==typeof Array.prototype.indexOf)return t.indexOf(e);for(var n=0;n<t.length;n++)if(t[n]===e)return n;return-1}(["eval","<anonymous>"],r[0])>-1?void 0:r[0];return new t(i,void 0,o,r[1],r[2],e)},this)},parseFFOrSafari:function(e){return i(o(e.stack.split("\n"),function(t){return!t.match(r)},this),function(e){if(e.indexOf(" > eval")>-1&&(e=e.replace(/ line (\d+)(?: > eval line \d+)* > eval\:\d+\:\d+/g,":$1")),-1===e.indexOf("@")&&-1===e.indexOf(":"))return new t(e);var n=e.split("@"),r=this.extractLocation(n.pop()),i=n.join("@")||void 0;return new t(i,void 0,r[0],r[1],r[2],e)},this)},parseOpera:function(t){return!t.stacktrace||t.message.indexOf("\n")>-1&&t.message.split("\n").length>t.stacktrace.split("\n").length?this.parseOpera9(t):t.stack?this.parseOpera11(t):this.parseOpera10(t)},parseOpera9:function(e){for(var n=/Line (\d+).*script (?:in )?(\S+)/i,r=e.message.split("\n"),i=[],o=2,s=r.length;o<s;o+=2){var a=n.exec(r[o]);a&&i.push(new t(void 0,void 0,a[2],a[1],void 0,r[o]))}return i},parseOpera10:function(e){for(var n=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,r=e.stacktrace.split("\n"),i=[],o=0,s=r.length;o<s;o+=2){var a=n.exec(r[o]);a&&i.push(new t(a[3]||void 0,void 0,a[2],a[1],void 0,r[o]))}return i},parseOpera11:function(n){return i(o(n.stack.split("\n"),function(t){return!!t.match(e)&&!t.match(/^Error created at/)},this),function(e){var n,r=e.split("@"),i=this.extractLocation(r.pop()),o=r.shift()||"",s=o.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0;o.match(/\(([^\)]*)\)/)&&(n=o.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var a=void 0===n||"[arguments not available]"===n?void 0:n.split(",");return new t(s,a,i[0],i[1],i[2],e)},this)}}},i=[n(14)],void 0===(o="function"==typeof(r=s)?r.apply(e,i):r)||(t.exports=o)},function(t,e,n){"use strict";var r,i,o;"function"==typeof Symbol&&Symbol.iterator;i=[],void 0===(o="function"==typeof(r=function(){function t(t){return!isNaN(parseFloat(t))&&isFinite(t)}function e(t,e,n,r,i,o){void 0!==t&&this.setFunctionName(t),void 0!==e&&this.setArgs(e),void 0!==n&&this.setFileName(n),void 0!==r&&this.setLineNumber(r),void 0!==i&&this.setColumnNumber(i),void 0!==o&&this.setSource(o)}return e.prototype={getFunctionName:function(){return this.functionName},setFunctionName:function(t){this.functionName=String(t)},getArgs:function(){return this.args},setArgs:function(t){if("[object Array]"!==Object.prototype.toString.call(t))throw new TypeError("Args must be an Array");this.args=t},getFileName:function(){return this.fileName},setFileName:function(t){this.fileName=String(t)},getLineNumber:function(){return this.lineNumber},setLineNumber:function(e){if(!t(e))throw new TypeError("Line Number must be a Number");this.lineNumber=Number(e)},getColumnNumber:function(){return this.columnNumber},setColumnNumber:function(e){if(!t(e))throw new TypeError("Column Number must be a Number");this.columnNumber=Number(e)},getSource:function(){return this.source},setSource:function(t){this.source=String(t)},toString:function(){return(this.getFunctionName()||"{anonymous}")+("("+(this.getArgs()||[]).join(",")+")")+(this.getFileName()?"@"+this.getFileName():"")+(t(this.getLineNumber())?":"+this.getLineNumber():"")+(t(this.getColumnNumber())?":"+this.getColumnNumber():"")}},e})?r.apply(e,i):r)||(t.exports=o)},function(t,e,n){"use strict";var r=n(16),i=n(17);t.exports={PerformanceMonitoring:r,registerServices:function(t){t.registerServiceCreator("TransactionService",function(){var e=t.getService("ConfigService"),n=t.getService("LoggingService");return new i(n,e)}),t.registerServiceCreator("PerformanceMonitoring",function(){var e=t.getService("ConfigService"),n=t.getService("LoggingService"),i=t.getService("ApmServer"),o=t.getService("TransactionService");return new r(i,e,n,void 0,o)})}}},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var i=n(0),o=function(){function t(e,n,r,i,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._apmServer=e,this._configService=n,this._logginService=r,this._zoneService=i,this._transactionService=o}return r(t,[{key:"init",value:function(){this._zoneService&&this._zoneService.initialize(window.Zone.current);var t=this;this._transactionService.subscribe(function(e){var n=t.createTransactionPayload(e);n&&t._apmServer.addTransaction(n)})}},{key:"setTransactionContextInfo",value:function(t){var e=this._configService.get("context");e&&t.addContextInfo(e)}},{key:"filterTransaction",value:function(t){var e=this._configService.get("browserResponsivenessInterval");if(this._configService.get("checkBrowserResponsiveness")&&!t.isHardNavigation){var n=this._configService.get("browserResponsivenessBuffer"),r=t.duration();if(!this.checkBrowserResponsiveness(t,e,n))return this._logginService.debug("Transaction was discarded! browser was not responsive enough during the transaction."," duration:",r," browserResponsivenessCounter:",t.browserResponsivenessCounter,"interval:",e),!1}return!0}},{key:"prepareTransaction",value:function(t){if(t.spans.sort(function(t,e){return t._start-e._start}),this._configService.get("groupSimilarSpans")){var e=this._configService.get("similarSpanThreshold");t.spans=this.groupSmallContinuouslySimilarSpans(t,e)}this.setTransactionContextInfo(t)}},{key:"createTransactionDataModel",value:function(t){var e=this._configService.get("context"),n=this._configService.get("serverStringLimit"),r=t._rootSpan._start,o=t.spans.map(function(t){var e;return t.context&&(e=i.sanitizeObjectStrings(t.context,n)),{name:i.sanitizeString(t.signature,n,!0),type:i.sanitizeString(t.type,n,!0),start:t._start-r,duration:t.duration(),context:e}}),s=i.merge({},e,t.contextInfo);return{id:t.id,timestamp:t.timestamp,name:i.sanitizeString(t.name,n,!1),type:i.sanitizeString(t.type,n,!0),duration:t.duration(),spans:o,context:s,marks:t.marks}}},{key:"createTransactionPayload",value:function(t){if(this.prepareTransaction(t),this.filterTransaction(t))return this.createTransactionDataModel(t)}},{key:"sendTransactions",value:function(t){var e=t.map(this.createTransactionPayload.bind(this)).filter(function(t){return t});return this._logginService.debug("Sending Transactions to apm server.",t.length),this._apmServer.sendTransactions(e)}},{key:"convertTransactionsToServerModel",value:function(t){return t.map(this.createTransactionDataModel.bind(this))}},{key:"groupSmallContinuouslySimilarSpans",value:function(t,e){var n=t.duration(),r=[],i=1;return t.spans.forEach(function(o,s){if(0===r.length)r.push(o);else{var a=r[r.length-1],c=a.type===o.type&&a.signature===o.signature&&o.duration()/n<e&&(o._start-a._end)/n<e,u=t.spans.length===s+1;c&&(i++,a._end=o._end),i>1&&(!c||u)&&(a.signature=i+"x "+a.signature,i=1),c||r.push(o)}}),r}},{key:"checkBrowserResponsiveness",value:function(t,e,n){var r=t.browserResponsivenessCounter;if(void 0===e||void 0===r)return!0;var i=t.duration();return r+n>=Math.floor(i/e)}}]),t}();t.exports=o},function(t,e,n){"use strict";var r=n(18),i=n(0),o=n(4),s=n(19);function a(t,e){this._config=e,void 0===e&&t.debug("TransactionService: config is not provided"),this._logger=t,this.nextAutoTaskId=1,this.taskMap={},this.metrics={},this.initialPageLoadName=void 0,this.currentTransaction=void 0,this._subscription=new o,this._alreadyCapturedPageLoad=!1}a.prototype.shouldCreateTransaction=function(){return this._config.isActive()},a.prototype.getZoneTransaction=function(){return this.currentTransaction},a.prototype.setZoneTransaction=function(t){this.currentTransaction=t},a.prototype.createTransaction=function(t,e,n){var o=n;if(i.isUndefined(o)&&(o=this._config.config),this.shouldCreateTransaction()){var s=new r(t,e,o,this._logger);return this.setZoneTransaction(s),o.checkBrowserResponsiveness&&this.startCounter(s),s}},a.prototype.createZoneTransaction=function(){return this.createTransaction("ZoneTransaction","transaction")},a.prototype.getCurrentTransaction=function(){if(this.shouldCreateTransaction()){var t=this.getZoneTransaction();return i.isUndefined(t)||t.ended?this.createZoneTransaction():t}},a.prototype.startCounter=function(t){t.browserResponsivenessCounter=0;var e=this._config.get("browserResponsivenessInterval");void 0!==e?this.runOuter(function(){var n=setInterval(function(){t.ended?window.clearInterval(n):t.browserResponsivenessCounter++},e)}):this._logger.debug("browserResponsivenessInterval is undefined!")},a.prototype.sendPageLoadMetrics=function(t){var e,n=this,i=this._config.config;e=this.getZoneTransaction();var o=t||this.initialPageLoadName,s=!1;return o||(o="Unknown",s=!0),e&&"ZoneTransaction"===e.name?e.redefine(o,"page-load",i):e=new r(o,"page-load",i,this._logger),e.isHardNavigation=!0,e.unknownName=s,e.doneCallback=function(){n.applyAsync(function(){n.capturePageLoadMetrics(e)&&n.add(e)})},e.detectFinish(),e},a.prototype.capturePageLoadMetrics=function(t){if(this._config.get("capturePageLoad")&&!this._alreadyCapturedPageLoad&&t.isHardNavigation)return t.addMarks(this.metrics),s(t),this._alreadyCapturedPageLoad=!0,!0},a.prototype.startTransaction=function(t,e){var n=this,r=this._config.config;if("interaction"!==e||r.captureInteractions){var i=this.getCurrentTransaction();if(i)return"ZoneTransaction"!==i.name?(this.logInTransaction("Ending early to start a new transaction:",t,e),this._logger.debug("Ending old transaction",i),i.end(),i=this.createTransaction(t,e)):i.redefine(t,e,r),this._logger.debug("TransactionService.startTransaction",i),i.doneCallback=function(){n.applyAsync(function(){n._logger.debug("TransactionService transaction finished",i),i.spans.length>0&&!n.shouldIgnoreTransaction(i.name)&&(n.capturePageLoadMetrics(i),n.add(i))})},i}},a.prototype.applyAsync=function(t,e,n){return this.runOuter(function(){return Promise.resolve().then(function(){return t.apply(e,n)},function(t){console.log(t)})})},a.prototype.shouldIgnoreTransaction=function(t){for(var e=this._config.get("ignoreTransactions"),n=0;n<e.length;n++){var r=e[n];if("function"==typeof r.test){if(r.test(t))return!0}else if(r===t)return!0}return!1},a.prototype.startSpan=function(t,e,n){var r=this.getCurrentTransaction();if(r)return this._logger.debug("TransactionService.startSpan",t,e),r.startSpan(t,e,n)},a.prototype.add=function(t){this._config.isActive()&&(this._subscription.applyAll(this,[t]),this._logger.debug("TransactionService.add",t))},a.prototype.subscribe=function(t){return this._subscription.subscribe(t)},a.prototype.addTask=function(t){var e=this.getCurrentTransaction();return e&&(void 0===t&&(t="autoId"+this.nextAutoTaskId++),e.addTask(t),this._logger.debug("TransactionService.addTask",t)),t},a.prototype.removeTask=function(t){var e=this.getZoneTransaction();i.isUndefined(e)||e.ended||(e.removeTask(t),this._logger.debug("TransactionService.removeTask",t))},a.prototype.logInTransaction=function(){var t=this.getZoneTransaction();i.isUndefined(t)||t.ended||t.debugLog.apply(t,arguments)},a.prototype.setDebugDataOnTransaction=function(t,e){var n=this.getZoneTransaction();i.isUndefined(n)||n.ended||n.setDebugData(t,e)},a.prototype.detectFinish=function(){var t=this.getZoneTransaction();i.isUndefined(t)||t.ended||(t.detectFinish(),this._logger.debug("TransactionService.detectFinish"))},a.prototype.runOuter=function(t,e,n){return t.apply(e,n)},t.exports=a},function(t,e,n){"use strict";var r=n(3),i=n(0),o=n(2),s=function(t,e,n,i){this.id=o(),this.timestamp=(new Date).toISOString(),this.metadata={},this.name=t,this.type=e,this.ended=!1,this._isDone=!1,this._options=n,this._logger=i,void 0===n&&(this._options={}),this.contextInfo={},this.marks={},this._options.sendVerboseDebugInfo&&this.debugLog("Transaction",t,e),this.spans=[],this._activeSpans={},this._scheduledTasks={},this.events={},this.doneCallback=function(){},this._rootSpan=new r("transaction","transaction",{enableStackFrames:!1}),this._startStamp=new Date,this.duration=this._rootSpan.duration.bind(this._rootSpan),this.nextId=0,this.isHardNavigation=!1};s.prototype.debugLog=function(){if(this._options.sendVerboseDebugInfo){this.contextInfo._debug||(this.contextInfo._debug={log:[]}),this.contextInfo._debug.log||(this.contextInfo._debug.log=[]);var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);t.unshift(Date.now().toString());var e=t.join(" - ");this.contextInfo._debug.log.push(e),this._logger&&this._logger.debug(e)}},s.prototype.addContextInfo=function(t){i.merge(this.contextInfo,t)},s.prototype.setDebugData=function(t,e){this.contextInfo._debug||(this.contextInfo._debug={}),this.contextInfo._debug[t]=e},s.prototype.addMarks=function(t){this.marks=i.merge(this.marks,t)},s.prototype.redefine=function(t,e,n){this.debugLog("redefine",t,e),this.name=t,this.type=e,this._options=n},s.prototype.startSpan=function(t,e,n){var i=this;this.debugLog("startSpan",t,e);var o=void 0===n?{}:n;o.enableStackFrames=!0===this._options.enableStackFrames&&!1!==o.enableStackFrames,o.onSpanEnd=function(t){i._onSpanEnd(t)};var s=new r(t,e,o);return s.id=this.nextId,this.nextId++,this._activeSpans[s.id]=s,s},s.prototype.isFinished=function(){var t=Object.keys(this._scheduledTasks);return this.debugLog("isFinished scheduledTasks",t),0===t.length},s.prototype.detectFinish=function(){this.isFinished()&&this.end()},s.prototype.end=function(){this.ended||(this.debugLog("end"),this.ended=!0,this.addContextInfo({url:{location:window.location.href}}),this._rootSpan.end(),!0===this.isFinished()&&this._finish())},s.prototype.addTask=function(t){this.debugLog("addTask",t),this._scheduledTasks[t]=t},s.prototype.removeTask=function(t){this.debugLog("removeTask",t),this.setDebugData("lastRemovedTask",t),delete this._scheduledTasks[t]},s.prototype.addEndedSpans=function(t){this.spans=this.spans.concat(t)},s.prototype._onSpanEnd=function(t){this.spans.push(t),t._scheduledTasks=Object.keys(this._scheduledTasks),delete this._activeSpans[t.id]},s.prototype._finish=function(){!0!==this._alreadFinished&&(this._alreadFinished=!0,this._adjustStartToEarliestSpan(),this._adjustEndToLatestSpan(),this.doneCallback(this))},s.prototype._adjustEndToLatestSpan=function(){var t=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n];r.type&&-1===r.type.indexOf("ext")&&"transaction"!==r.type&&(!e||e._end<r._end)&&(e=r)}return e}(this.spans);if(t){this._rootSpan._end=t._end;for(var e=0;e<this.spans.length;e++){var n=this.spans[e];n._end>this._rootSpan._end&&(n._end=this._rootSpan._end,n.type=n.type+".truncated")}}},s.prototype._adjustStartToEarliestSpan=function(){var t,e,n=(t=this.spans,e=null,t.forEach(function(t){e||(e=t),e&&e._start>t._start&&(e=t)}),e);n&&n._start<this._rootSpan._start&&(this._rootSpan._start=n._start)},t.exports=s},function(t,e,n){"use strict";var r=n(3),i=n(0),o=[["domainLookupStart","domainLookupEnd","Domain lookup"],["connectStart","connectEnd","Making a connection to the server"],["requestStart","responseStart","Requesting the document, waiting for the first byte"],["responseStart","responseEnd","Receiving the document"],["domLoading","domInteractive","Parsing the document, executing sync. scripts"],["domContentLoadedEventStart","domContentLoadedEventEnd",'Fire "DOMContentLoaded" event'],["loadEventStart","loadEventEnd",'Fire "load" event']],s=["navigationStart","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"],a=3e5;function c(t,e){var n=e.duration();return n<a&&n>0&&e._start<=t._rootSpan._end&&e._end<=t._rootSpan._end}t.exports=function(t){if(t.isHardNavigation&&window.performance&&window.performance.timing){var e=window.performance.timing.fetchStart,n=window.performance.timing;t._rootSpan._start=0,t.type="page-load";for(var a=0;a<o.length;a++){var u=n[o[a][0]],f=n[o[a][1]];if(u&&f&&f-u!=0){var l=new r(o[a][2],"hard-navigation.browser-timing");l._start=n[o[a][0]]-e,l.ended=!0,l.end(),l._end=n[o[a][1]]-e,c(t,l)&&t.spans.push(l)}}if(window.performance.getEntriesByType){var h=window.performance.getEntriesByType("resource"),p=t.spans.filter(function(t){return t.type.indexOf("ext.HttpRequest")>-1}).map(function(t){return t.signature.split(" ")[1]});for(a=0;a<h.length;a++){var d=h[a];if(!d.initiatorType||"xmlhttprequest"!==d.initiatorType)if("css"!==d.initiatorType&&"img"!==d.initiatorType&&"script"!==d.initiatorType&&"link"!==d.initiatorType){for(var v=!1,g=0;g<p.length;g++){var y=d.name.lastIndexOf(p[g]);if(y>-1&&y===d.name.length-p[g].length){v=!0;break}}if(v)continue}else{var m="resource";d.initiatorType&&(m+="."+d.initiatorType);var S=i.parseUrl(d.name);(l=new r(S.path||d.name,m)).setContext({http:{url:{raw:d.name}}}),l._start=d.startTime,l.ended=!0,l.end(),l._end=d.responseEnd,c(t,l)&&t.spans.push(l)}}}t._adjustStartToEarliestSpan(),t._adjustEndToLatestSpan();var b={agent:{timeToComplete:t._rootSpan._end},navigationTiming:{}},_=window.performance.timing.navigationStart;s.forEach(function(t){var e=n[t];e&&(b.navigationTiming[t]=e-_)}),t.addMarks(b)}return 0}},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var i=n(21),o=n(24),s=n(25),a=n(5),c=n(0),u=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._serviceCreators={},this._serviceInstances={},this.initialized=!1}return r(t,[{key:"registerCoreServices",value:function(){var t=this;this.registerServiceCreator("ConfigService",function(){return new o}),this.registerServiceCreator("LoggingService",function(){return new s}),this.registerServiceCreator("ApmServer",function(){return new i(t.getService("ConfigService"),t.getService("LoggingService"))}),this.registerServiceInstance("PatchUtils",a),this.registerServiceInstance("Utils",c)}},{key:"init",value:function(){if(!this.initialized){this.initialized=!0;var t=this.getService("ConfigService");t.init();var e=this.getService("LoggingService");n(e,t),t.subscribeToChange(function(r){n(e,t)}),this.getService("ApmServer").init()}function n(t,e){!0===e.get("debug")&&"trace"!==e.config.logLevel?t.setLevel("debug",!1):t.setLevel(e.get("logLevel"),!1)}}},{key:"registerServiceCreator",value:function(t,e){this._serviceCreators[t]=e}},{key:"registerServiceInstance",value:function(t,e){this._serviceInstances[t]=e}},{key:"getService",value:function(t){if(!this._serviceInstances[t]){if("function"!=typeof this._serviceCreators[t])throw new Error("Can not get service, No creator for: "+t);this._serviceInstances[t]=this._serviceCreators[t](this)}return this._serviceInstances[t]}}]),t}();t.exports=u},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var i=n(22),o=n(23),s=n(0),a=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._configService=e,this._loggingService=n,this.logMessages={invalidConfig:{message:"Configuration is invalid!",level:"warn"}},this.errorQueue=void 0,this.transactionQueue=void 0,this.throttleAddError=void 0,this.throttleAddTransaction=void 0,this.initialized=!1,this._throttledMakeRequest}return r(t,[{key:"init",value:function(){this.initialized||(this.initialized=!0,this.initErrorQueue(),this.initTransactionQueue())}},{key:"createServiceObject",value:function(){var t=this._configService,e=t.get("serverStringLimit");return{name:s.sanitizeString(t.get("serviceName"),e,!0),version:s.sanitizeString(t.get("serviceVersion"),e,!1),agent:{name:t.get("agentName"),version:t.get("agentVersion")},language:{name:"javascript"}}}},{key:"_postJson",value:function(t,e){return this._makeHttpRequest("POST",t,JSON.stringify(e),{"Content-Type":"application/json"})}},{key:"_makeHttpRequest",value:function(t,e,n,r){return new Promise(function(i,o){var s=new window.XMLHttpRequest;if(s.open(t,e,!0),s.timeout=1e4,r)for(var a in r)r.hasOwnProperty(a)&&s.setRequestHeader(a,r[a]);s.onreadystatechange=function(t){if(4===s.readyState){var n=s.status;if(0===n||n>399&&n<600){var r=new Error(e+" HTTP status: "+n);r.xhr=s,o(r)}else i(s.responseText)}},s.onerror=function(t){o(t)},s.send(n)})}},{key:"_createQueue",value:function(t){var e=this._configService.get("queueLimit"),n=this._configService.get("flushInterval");return new i(t,{queueLimit:e,flushInterval:n})}},{key:"initErrorQueue",value:function(){var t=this;this.errorQueue&&this.errorQueue.flush(),this.errorQueue=this._createQueue(function(e){var n=t.sendErrors(e);n&&n.then(void 0,function(e){t._loggingService.warn("Failed sending errors!",e)})});var e=t._configService.get("errorThrottleLimit"),n=t._configService.get("errorThrottleInterval");this.throttleAddError=o(this.errorQueue.add.bind(this.errorQueue),function(e,n){t._loggingService.warn("Dropped error due to throttling!")},{limit:e,interval:n})}},{key:"initTransactionQueue",value:function(){var t=this;this.transactionQueue&&this.transactionQueue.flush(),this.transactionQueue=this._createQueue(function(e){var n=t.sendTransactions(e);n&&n.then(void 0,function(e){t._loggingService.warn("Failed sending transactions!",e)})});var e=t._configService.get("transactionThrottleLimit"),n=t._configService.get("transactionThrottleInterval");this.throttleAddTransaction=o(this.transactionQueue.add.bind(this.transactionQueue),function(){t._loggingService.warn("Dropped transaction due to throttling!")},{limit:e,interval:n})}},{key:"addError",value:function(t){this._configService.isActive()&&(this.errorQueue||this.initErrorQueue(),this.throttleAddError(t))}},{key:"addTransaction",value:function(t){this._configService.isActive()&&(this.transactionQueue||this.initTransactionQueue(),this.throttleAddTransaction(t))}},{key:"warnOnce",value:function(t){"warn"===t.level?(t.level="debug",this._loggingService.warn(t.message)):this._loggingService.debug(t.message)}},{key:"sendErrors",value:function(t){if(this._configService.isValid()&&this._configService.isActive()){if(t&&t.length>0){var e={service:this.createServiceObject(),errors:t};if(e=this._configService.applyFilters(e)){var n=this._configService.getEndpointUrl("errors");return this._postJson(n,e)}this._loggingService.warn("Dropped payload due to filtering!")}}else this.warnOnce(this.logMessages.invalidConfig)}},{key:"sendTransactions",value:function(t){if(this._configService.isValid()&&this._configService.isActive()){if(t&&t.length>0){var e={service:this.createServiceObject(),transactions:t};if(e=this._configService.applyFilters(e)){var n=this._configService.getEndpointUrl("transactions");return this._postJson(n,e)}this._loggingService.warn("Dropped payload due to filtering!")}}else this.warnOnce(this.logMessages.invalidConfig)}}]),t}();t.exports=a},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var i=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n||(n={}),this.onFlush=e,this.items=[],this.queueLimit=n.queueLimit||-1,this.flushInterval=n.flushInterval||0,this.timeoutId=void 0}return r(t,[{key:"_setTimer",value:function(){var t=this;this.timeoutId=setTimeout(function(){t.flush()},this.flushInterval)}},{key:"flush",value:function(){this.onFlush(this.items),this._clear()}},{key:"_clear",value:function(){void 0!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.items=[]}},{key:"add",value:function(t){this.items.push(t),-1!==this.queueLimit&&this.items.length>=this.queueLimit?this.flush():void 0===this.timeoutId&&this._setTimer()}}]),t}();t.exports=i},function(t,e,n){"use strict";t.exports=function(t,e,n){var r,i=n.context||this,o=n.limit,s=n.interval,a=n.countFn||function(){},c=0;return function(){var n="function"==typeof a&&a.apply(i,arguments);return"number"!=typeof n&&(n=1),c+=n,void 0===r&&(r=setTimeout(function(){c=0,r=void 0},s)),c>o?"function"==typeof e?e.apply(i,arguments):void 0:t.apply(i,arguments)}}},function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=n(0),o=n(4);function s(){this.config={},this.defaults={serviceName:"",serviceVersion:"",agentName:"js-base",agentVersion:"0.6.1",serverUrl:"http://localhost:8200",serverUrlPrefix:"/v1/client-side",active:!0,isInstalled:!1,debug:!1,logLevel:"warn",browserResponsivenessInterval:500,browserResponsivenessBuffer:3,checkBrowserResponsiveness:!0,enable:!0,enableStackFrames:!1,groupSimilarSpans:!0,similarSpanThreshold:.05,captureInteractions:!1,sendVerboseDebugInfo:!1,includeXHRQueryString:!1,capturePageLoad:!0,ignoreTransactions:[],errorThrottleLimit:20,errorThrottleInterval:3e4,transactionThrottleLimit:20,transactionThrottleInterval:3e4,queueLimit:-1,flushInterval:500,hasRouterLibrary:!1,serverStringLimit:1024,context:{},platform:{}},this._changeSubscription=new o,this.filters=[]}s.prototype.isActive=function(){return this.get("active")},s.prototype.addFilter=function(t){if("function"!=typeof t)throw new Error("Argument to must be function");this.filters.push(t)},s.prototype.applyFilters=function(t){for(var e=0;e<this.filters.length;e++)if(!(t=this.filters[e](t)))return;return t},s.prototype.init=function(){var t=a();this.setConfig(t)},s.prototype.get=function(t){return i.arrayReduce(t.split("."),function(t,e){return t&&t[e]},this.config)},s.prototype.getEndpointUrl=function(t){return this.get("serverUrl")+this.get("serverUrlPrefix")+"/"+t},s.prototype.set=function(t,e){var n=t.split("."),r=n.length-1,o=this.config;i.arraySome(n,function(t,n){if(void 0===t)return!0;if(n===r)o[t]=e;else{var i=o[t]||{};o[t]=i,o=i}})},s.prototype.setUserContext=function(t){var e={};"number"==typeof t.id&&(e.id=t.id),"string"==typeof t.id&&(e.id=i.sanitizeString(t.id,this.get("serverStringLimit"))),"string"==typeof t.username&&(e.username=i.sanitizeString(t.username,this.get("serverStringLimit"))),"string"==typeof t.email&&(e.email=i.sanitizeString(t.email,this.get("serverStringLimit"))),this.set("context.user",e)},s.prototype.setCustomContext=function(t){t&&"object"===(void 0===t?"undefined":r(t))&&this.set("context.custom",t)},s.prototype.setTag=function(t,e){if(!t)return!1;this.config.context.tags||(this.config.context.tags={});var n=t.replace(/[.*]/g,"_");this.config.context.tags[n]=i.sanitizeString(e,this.get("serverStringLimit"))},s.prototype.setTags=function(t){var e=this;Object.keys(t).forEach(function(n){e.setTag(n,t[n])})},s.prototype.getAgentName=function(){var t=this.config.agentVersion;return t||(t="dev"),this.get("agentName")+"/"+t},s.prototype.setConfig=function(t){t=t||{},this.config=i.merge({},this.defaults,this.config,t),this._changeSubscription.applyAll(this,[this.config])},s.prototype.subscribeToChange=function(t){return this._changeSubscription.subscribe(t)},s.prototype.isValid=function(){var t=i.arrayMap(["serviceName","serverUrl"],i.functionBind(function(t){return null===this.config[t]||void 0===this.config[t]||""===this.config[t]},this));return-1===i.arrayIndexOf(t,!0)};var a=function(){return function(t){var e={},n=/^data\-([\w\-]+)$/;if(t)for(var r=t.attributes,o=0;o<r.length;o++){var s=r[o];if(n.test(s.nodeName)){var a=s.nodeName.match(n)[1];a=i.arrayMap(a.split("-"),function(t,e){return e>0?t.charAt(0).toUpperCase()+t.substring(1):t}).join(""),e[a]=s.value||s.nodeValue}}return e}(i.getCurrentScript())};s.prototype.isPlatformSupported=function(){return"function"==typeof Array.prototype.forEach&&"function"==typeof JSON.stringify&&"function"==typeof Function.bind&&window.performance&&"function"==typeof window.performance.now&&i.isCORSSupported()},t.exports=s},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function i(){}var o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e||(e={}),this.levels=["trace","debug","info","warn","error"],this.level=e.level||"info",this.prefix=e.prefix||"",this.resetLogMethods()}return r(t,[{key:"shouldLog",value:function(t){return this.levels.indexOf(t)>=this.levels.indexOf(this.level)}},{key:"setLevel",value:function(t){this.level=t,this.resetLogMethods()}},{key:"resetLogMethods",value:function(){var t=this;this.levels.forEach(function(e){t[e]=t.shouldLog(e)?function(){var n,r=t.prefix;switch(e){case"trace":case"debug":n="info";break;default:n=e}var i=arguments;r&&("function"==typeof r&&(r=r(e)),i[0]=r+i[0]);if(console){var o=console[n]?console[n]:console.log;"function"==typeof o&&o.apply(console,i)}}:i})}}]),t}();t.exports=o},function(t,e,n){"use strict";var r=n(27);t.exports=function(){r()}},function(t,e,n){"use strict";var r=n(5),i=r.apmSymbol("url"),o=r.apmSymbol("method"),s=r.apmSymbol("isAsync");t.exports=function(){r.patchMethod(window.XMLHttpRequest.prototype,"open",function(t){return function(e,n){e[o]=n[0],e[i]=n[1],e[s]=n[2],t.apply(e,n)}})}},function(t,e,n){"use strict";t.exports=n(29).polyfill()},function(t,e,n){"use strict";var r,i,o,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};o=function(){function t(t){return"function"==typeof t}var e=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},n=0,r=void 0,i=void 0,o=function(t,e){p[n]=t,p[n+1]=e,2===(n+=2)&&(i?i(d):S())};var a="undefined"!=typeof window?window:void 0,c=a||{},u=c.MutationObserver||c.WebKitMutationObserver,f="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),l="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function h(){var t=setTimeout;return function(){return t(d,1)}}var p=new Array(1e3);function d(){for(var t=0;t<n;t+=2){(0,p[t])(p[t+1]),p[t]=void 0,p[t+1]=void 0}n=0}var v,g,y,m,S=void 0;function b(t,e){var n=this,r=new this.constructor(T);void 0===r[w]&&U(r);var i=n._state;if(i){var s=arguments[i-1];o(function(){return M(i,r,s,n._result)})}else P(n,r,t,e);return r}function _(t){if(t&&"object"===(void 0===t?"undefined":s(t))&&t.constructor===this)return t;var e=new this(T);return A(e,t),e}f?S=function(){return process.nextTick(d)}:u?(g=0,y=new u(d),m=document.createTextNode(""),y.observe(m,{characterData:!0}),S=function(){m.data=g=++g%2}):l?((v=new MessageChannel).port1.onmessage=d,S=function(){return v.port2.postMessage(0)}):S=void 0===a?function(){try{var t=Function("return this")().require("vertx");return void 0!==(r=t.runOnLoop||t.runOnContext)?function(){r(d)}:h()}catch(t){return h()}}():h();var w=Math.random().toString(36).substring(2);function T(){}var k=void 0,x=1,E=2,C={error:null};function L(t){try{return t.then}catch(t){return C.error=t,C}}function O(e,n,r){n.constructor===e.constructor&&r===b&&n.constructor.resolve===_?function(t,e){e._state===x?N(t,e._result):e._state===E?F(t,e._result):P(e,void 0,function(e){return A(t,e)},function(e){return F(t,e)})}(e,n):r===C?(F(e,C.error),C.error=null):void 0===r?N(e,n):t(r)?function(t,e,n){o(function(t){var r=!1,i=function(t,e,n,r){try{t.call(e,n,r)}catch(t){return t}}(n,e,function(n){r||(r=!0,e!==n?A(t,n):N(t,n))},function(e){r||(r=!0,F(t,e))},t._label);!r&&i&&(r=!0,F(t,i))},t)}(e,n,r):N(e,n)}function A(t,e){var n,r;t===e?F(t,new TypeError("You cannot resolve a promise with itself")):(r=void 0===(n=e)?"undefined":s(n),null===n||"object"!==r&&"function"!==r?N(t,e):O(t,e,L(e)))}function I(t){t._onerror&&t._onerror(t._result),j(t)}function N(t,e){t._state===k&&(t._result=e,t._state=x,0!==t._subscribers.length&&o(j,t))}function F(t,e){t._state===k&&(t._state=E,t._result=e,o(I,t))}function P(t,e,n,r){var i=t._subscribers,s=i.length;t._onerror=null,i[s]=e,i[s+x]=n,i[s+E]=r,0===s&&t._state&&o(j,t)}function j(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,i=void 0,o=t._result,s=0;s<e.length;s+=3)r=e[s],i=e[s+n],r?M(n,r,i,o):i(o);t._subscribers.length=0}}function M(e,n,r,i){var o=t(r),s=void 0,a=void 0,c=void 0,u=void 0;if(o){if((s=function(t,e){try{return t(e)}catch(t){return C.error=t,C}}(r,i))===C?(u=!0,a=s.error,s.error=null):c=!0,n===s)return void F(n,new TypeError("A promises callback cannot return that same promise."))}else s=i,c=!0;n._state!==k||(o&&c?A(n,s):u?F(n,a):e===x?N(n,s):e===E&&F(n,s))}var R=0;function U(t){t[w]=R++,t._state=void 0,t._result=void 0,t._subscribers=[]}var D=function(){function t(t,n){this._instanceConstructor=t,this.promise=new t(T),this.promise[w]||U(this.promise),e(n)?(this.length=n.length,this._remaining=n.length,this._result=new Array(this.length),0===this.length?N(this.promise,this._result):(this.length=this.length||0,this._enumerate(n),0===this._remaining&&N(this.promise,this._result))):F(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===k&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===_){var i=L(t);if(i===b&&t._state!==k)this._settledAt(t._state,e,t._result);else if("function"!=typeof i)this._remaining--,this._result[e]=t;else if(n===z){var o=new n(T);O(o,t,i),this._willSettleAt(o,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},t.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===k&&(this._remaining--,t===E?F(r,n):this._result[e]=n),0===this._remaining&&N(r,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;P(t,void 0,function(t){return n._settledAt(x,e,t)},function(t){return n._settledAt(E,e,t)})},t}();var z=function(){function t(e){this[w]=R++,this._result=this._state=void 0,this._subscribers=[],T!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(t,e){try{e(function(e){A(t,e)},function(e){F(t,e)})}catch(e){F(t,e)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(t){return this.then(null,t)},t.prototype.finally=function(t){var e=this.constructor;return this.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){throw n})})},t}();return z.prototype.then=b,z.all=function(t){return new D(this,t).promise},z.race=function(t){var n=this;return e(t)?new n(function(e,r){for(var i=t.length,o=0;o<i;o++)n.resolve(t[o]).then(e,r)}):new n(function(t,e){return e(new TypeError("You must pass an array to race."))})},z.resolve=_,z.reject=function(t){var e=new this(T);return F(e,t),e},z._setScheduler=function(t){i=t},z._setAsap=function(t){o=t},z._asap=o,z.polyfill=function(){var t=void 0;if("undefined"!=typeof global)t=global;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=z},z.Promise=z,z},"object"===s(e)&&void 0!==t?t.exports=o():void 0===(i="function"==typeof(r=o)?r.call(e,n,e,t):r)||(t.exports=i)},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var i=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._disable=n,this.serviceFactory=e}return r(t,[{key:"init",value:function(t){if(this.isEnabled()){var e=this.serviceFactory.getService("ConfigService");e.setConfig({agentName:"js-base",agentVersion:"0.6.1"}),e.setConfig(t),this.serviceFactory.init(),this.serviceFactory.getService("ErrorLogging").registerGlobalEventListener(),this.serviceFactory.getService("PerformanceMonitoring").init(),this._sendPageLoadMetrics()}return this}},{key:"_sendPageLoadMetrics",value:function(){var t=this.serviceFactory.getService("TransactionService"),e=this.serviceFactory.getService("ConfigService"),n=function(){setTimeout(function(){e.get("hasRouterLibrary")||t.sendPageLoadMetrics()})};"complete"===document.readyState?n():window.addEventListener("load",n)}},{key:"isEnabled",value:function(){return!this._disable}},{key:"config",value:function(t){this.serviceFactory.getService("ConfigService").setConfig(t)}},{key:"setUserContext",value:function(t){this.serviceFactory.getService("ConfigService").setUserContext(t)}},{key:"setCustomContext",value:function(t){this.serviceFactory.getService("ConfigService").setCustomContext(t)}},{key:"setTags",value:function(t){this.serviceFactory.getService("ConfigService").setTags(t)}},{key:"setInitialPageLoadName",value:function(t){this.isEnabled()&&(this.serviceFactory.getService("TransactionService").initialPageLoadName=t)}},{key:"captureError",value:function(t){if(this.isEnabled())return this.serviceFactory.getService("ErrorLogging").logError(t)}},{key:"addFilter",value:function(t){this.serviceFactory.getService("ConfigService").addFilter(t)}}]),t}();t.exports=i}]);
//# sourceMappingURL=elastic-apm-js-base.umd.min.js.map